# uLog

uLog is simple log system based on UDP socket. When it works, it always include two entities:
1. ulog client generates log message and uses UDP socket to send the message stream to another host, i.e., ulog server
2. ulog server receive message stream from UDP socket. Then it parses the stream to get actual log and prints the log  on screen or outputs to a text file.

# Sample and Usage
## ulog client
[ulog_client.cpp](./sample/ulog_client.cpp) shows how to write a client code. It first initilizes ulog as below:
```
    uLog ulog;
    ulog.set_client(uLogDebug);
```

Then it calls `uLOG` marco to generate and send log message by UDP socket like this:
```
uLOG(uLogDebug, "Module", "s8=", s8);
```
`uLogDebug` is log level. `"Module"` is a user defined string to seperate different modules in a big project. `"s8=", s8` is log message main body.

**Notes:** A log message main body of `uLOG` marco can accept at most **16** input arguments.

### sync()
In order to reduce ulog overhead, when a log message is generated by calling `uLOG`, the generated message can still store in ulog internal buffer until the buffer size is over a threshold or the message level is `uLogWarning` or `uLogError`.

Sometimes, it is necessary to send out current message without the buffering even it is a low level log, then `ulog.sync()` should be called to support this feature.

**Notes:** `sync()` should be called before exiting client code, else there may be some logs are not sent to ulog server.

**Notes:** ulog uses UDP port `5400` and `127.0.0.1` as default ulog server.

## ulog server
[ulog_server.cpp](./sample/ulog_server.cpp) shows how to write a server code. It is very simple and can be used to receive and parse ulog message stream from any ulog client. It can be used as below two methods:
```
./ulog_server   # method 1
# or
./ulog_server log.txt  # method 2
```

For method 1, it prints parsed result on screen. It also saves the raw log into a binary file with the name `ulog_dump_yyyy_mm_dd_hh_mm_ss.bin`, where `yyyy_mm_dd_hh_mm_ss` is the dump starting time. 
For method 2, it prints parsed result into file `log.txt`. It also saves the raw log into a binary file with the name `log.bin`.


When an output file specified by `ulog_server` exists already, `ulog_server` will overwrite the file.

## ulog dump
[ulog_dump_server.cpp](./sample/ulog_dump_server.cpp) and [ulog_dump_parser.cpp](./sample/ulog_dump_parser.cpp) are paired to get high performance log function. `ulog_dump_server` is run first before ulog client start. All client side message are received by `ulog_dump_server` and saved in a file named `ulog_dump_yyyy_mm_dd_hh_mm_ss.bin`. Then after client side code finishing running, `ulog_dump_parser` is called to parse the binary file into human readiable log file.

The dump feature is preferred to be used when client code is released.

# Performance
The sample app `ulog_client` sends out 2016 log messages in about 8ms, i.e., about 4us per message.

At server side, `ulog_server` can only receive about 800 messages from the 2016 transmitted messages. This dues to file writing and message parsing take too much time and `ulog_server` misses a lot of UDP packets. This makes `ulog_server` can be used only when 
1. debugging phase
2. it is guaranteed that log density is low.

`ulog_dump_server` can store all 2016 raw message into file with out problem. It can be used for release code.




